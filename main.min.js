!function(){"use strict";angular.module("base64",[]).constant("$base64",function(){function e(e,t){var n=i.indexOf(e.charAt(t));if(-1==n)throw"Cannot decode base64";return n}function t(t){t=""+t;var n,r,i,o=t.length;if(0==o)return t;if(o%4!=0)throw"Cannot decode base64";n=0,t.charAt(o-1)==a&&(n=1,t.charAt(o-2)==a&&(n=2),o-=4);var s=[];for(r=0;o>r;r+=4)i=e(t,r)<<18|e(t,r+1)<<12|e(t,r+2)<<6|e(t,r+3),s.push(String.fromCharCode(i>>16,i>>8&255,255&i));switch(n){case 1:i=e(t,r)<<18|e(t,r+1)<<12|e(t,r+2)<<6,s.push(String.fromCharCode(i>>16,i>>8&255));break;case 2:i=e(t,r)<<18|e(t,r+1)<<12,s.push(String.fromCharCode(i>>16))}return s.join("")}function n(e,t){var n=e.charCodeAt(t);if(n>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return n}function r(e){if(1!=arguments.length)throw"SyntaxError: Not enough arguments";var t,r,o=[];e=""+e;var s=e.length-e.length%3;if(0==e.length)return e;for(t=0;s>t;t+=3)r=n(e,t)<<16|n(e,t+1)<<8|n(e,t+2),o.push(i.charAt(r>>18)),o.push(i.charAt(r>>12&63)),o.push(i.charAt(r>>6&63)),o.push(i.charAt(63&r));switch(e.length-s){case 1:r=n(e,t)<<16,o.push(i.charAt(r>>18)+i.charAt(r>>12&63)+a+a);break;case 2:r=n(e,t)<<16|n(e,t+1)<<8,o.push(i.charAt(r>>18)+i.charAt(r>>12&63)+i.charAt(r>>6&63)+a)}return o.join("")}var a="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";return{encode:r,decode:t}}())}(),function(e,t,n){"use strict";function r(){function e(e,n){return t.extend(new(t.extend(function(){},{prototype:e})),n)}function n(e,t){var n=t.caseInsensitiveMatch,r={originalPath:e,regexp:e},a=r.keys=[];return e=e.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?|\*])?/g,function(e,t,n,r){var i="?"===r?r:null,o="*"===r?r:null;return a.push({name:n,optional:!!i}),t=t||"",""+(i?"":t)+"(?:"+(i?t:"")+(o&&"(.+?)"||"([^/]+)")+(i||"")+")"+(i||"")}).replace(/([\/$\*])/g,"\\$1"),r.regexp=new RegExp("^"+e+"$",n?"i":""),r}var r={};this.when=function(e,a){if(r[e]=t.extend({reloadOnSearch:!0},a,e&&n(e,a)),e){var i="/"==e[e.length-1]?e.substr(0,e.length-1):e+"/";r[i]=t.extend({redirectTo:e},n(i,a))}return this},this.otherwise=function(e){return this.when(null,e),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$http","$templateCache","$sce",function(n,a,i,o,s,l,c,u){function d(e,t){var n=t.keys,r={};if(!t.regexp)return null;var a=t.regexp.exec(e);if(!a)return null;for(var i=1,o=a.length;o>i;++i){var s=n[i-1],l="string"==typeof a[i]?decodeURIComponent(a[i]):a[i];s&&l&&(r[s.name]=l)}return r}function h(){var e=p(),r=m.current;e&&r&&e.$$route===r.$$route&&t.equals(e.pathParams,r.pathParams)&&!e.reloadOnSearch&&!g?(r.params=e.params,t.copy(r.params,i),n.$broadcast("$routeUpdate",r)):(e||r)&&(g=!1,n.$broadcast("$routeChangeStart",e,r),m.current=e,e&&e.redirectTo&&(t.isString(e.redirectTo)?a.path(f(e.redirectTo,e.params)).search(e.params).replace():a.url(e.redirectTo(e.pathParams,a.path(),a.search())).replace()),o.when(e).then(function(){if(e){var n,r,a=t.extend({},e.resolve);return t.forEach(a,function(e,n){a[n]=t.isString(e)?s.get(e):s.invoke(e)}),t.isDefined(n=e.template)?t.isFunction(n)&&(n=n(e.params)):t.isDefined(r=e.templateUrl)&&(t.isFunction(r)&&(r=r(e.params)),r=u.getTrustedResourceUrl(r),t.isDefined(r)&&(e.loadedTemplateUrl=r,n=l.get(r,{cache:c}).then(function(e){return e.data}))),t.isDefined(n)&&(a.$template=n),o.all(a)}}).then(function(a){e==m.current&&(e&&(e.locals=a,t.copy(e.params,i)),n.$broadcast("$routeChangeSuccess",e,r))},function(t){e==m.current&&n.$broadcast("$routeChangeError",e,r,t)}))}function p(){var n,i;return t.forEach(r,function(r,o){!i&&(n=d(a.path(),r))&&(i=e(r,{params:t.extend({},a.search(),n),pathParams:n}),i.$$route=r)}),i||r[null]&&e(r[null],{params:{},pathParams:{}})}function f(e,n){var r=[];return t.forEach((e||"").split(":"),function(e,t){if(0===t)r.push(e);else{var a=e.match(/(\w+)(.*)/),i=a[1];r.push(n[i]),r.push(a[2]||""),delete n[i]}}),r.join("")}var g=!1,m={routes:r,reload:function(){g=!0,n.$evalAsync(h)}};return n.$on("$locationChangeSuccess",h),m}]}function a(){this.$get=function(){return{}}}function i(e,n,r){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(a,i,o,s,l){function c(){d&&(d.$destroy(),d=null),h&&(r.leave(h),h=null)}function u(){var o=e.current&&e.current.locals,s=o&&o.$template;if(t.isDefined(s)){var u=a.$new(),g=e.current,m=l(u,function(e){r.enter(e,null,h||i,function(){!t.isDefined(p)||p&&!a.$eval(p)||n()}),c()});h=m,d=g.scope=u,d.$emit("$viewContentLoaded"),d.$eval(f)}else c()}var d,h,p=o.autoscroll,f=o.onload||"";a.$on("$routeChangeSuccess",u),u()}}}function o(e,t,n){return{restrict:"ECA",priority:-400,link:function(r,a){var i=n.current,o=i.locals;a.html(o.$template);var s=e(a.contents());if(i.controller){o.$scope=r;var l=t(i.controller,o);i.controllerAs&&(r[i.controllerAs]=l),a.data("$ngControllerController",l),a.children().data("$ngControllerController",l)}s(r)}}}var s=t.module("ngRoute",["ng"]).provider("$route",r);s.provider("$routeParams",a),s.directive("ngView",i),s.directive("ngView",o),i.$inject=["$route","$anchorScroll","$animate"],o.$inject=["$compile","$controller","$route"]}(window,window.angular),function(e,t,n){"use strict";function r(){this.$get=["$$sanitizeUri",function(e){return function(t){var n=[];return o(t,c(n,function(t,n){return!/^unsafe/.test(e(t,n))})),n.join("")}}]}function a(e){var n=[],r=c(n,t.noop);return r.chars(e),n.join("")}function i(e){var t,n={},r=e.split(",");for(t=0;t<r.length;t++)n[r[t]]=!0;return n}function o(e,n){function r(e,r,i,o){if(r=t.lowercase(r),x[r])for(;c.last()&&C[c.last()];)a("",c.last());A[r]&&c.last()==r&&a("",r),o=S[r]||!!o,o||c.push(r);var l={};i.replace(p,function(e,t,n,r,a){var i=n||r||a||"";l[t]=s(i)}),n.start&&n.start(r,l,o)}function a(e,r){var a,i=0;if(r=t.lowercase(r))for(i=c.length-1;i>=0&&c[i]!=r;i--);if(i>=0){for(a=c.length-1;a>=i;a--)n.end&&n.end(c[a]);c.length=i}}var i,o,l,c=[],b=e;for(c.last=function(){return c[c.length-1]};e;){if(o=!0,c.last()&&L[c.last()])e=e.replace(new RegExp("(.*)<\\s*\\/\\s*"+c.last()+"[^>]*>","i"),function(e,t){return t=t.replace(m,"$1").replace(v,"$1"),n.chars&&n.chars(s(t)),""}),a("",c.last());else if(0===e.indexOf("<!--")?(i=e.indexOf("--",4),i>=0&&e.lastIndexOf("-->",i)===i&&(n.comment&&n.comment(e.substring(4,i)),e=e.substring(i+3),o=!1)):$.test(e)?(l=e.match($),l&&(e=e.replace(l[0],""),o=!1)):g.test(e)?(l=e.match(h),l&&(e=e.substring(l[0].length),l[0].replace(h,a),o=!1)):f.test(e)&&(l=e.match(d),l&&(e=e.substring(l[0].length),l[0].replace(d,r),o=!1)),o){i=e.indexOf("<");var w=0>i?e:e.substring(0,i);e=0>i?"":e.substring(i),n.chars&&n.chars(s(w))}if(e==b)throw u("badparse","The sanitizer was unable to parse the following block of html: {0}",e);b=e}a()}function s(e){if(!e)return"";var t=_.exec(e),n=t[1],r=t[3],a=t[2];return a&&(N.innerHTML=a.replace(/</g,"&lt;"),a="textContent"in N?N.textContent:N.innerText),n+a+r}function l(e){return e.replace(/&/g,"&amp;").replace(b,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function c(e,n){var r=!1,a=t.bind(e,e.push);return{start:function(e,i,o){e=t.lowercase(e),!r&&L[e]&&(r=e),r||I[e]!==!0||(a("<"),a(e),t.forEach(i,function(r,i){var o=t.lowercase(i),s="img"===e&&"src"===o||"background"===o;D[o]!==!0||T[o]===!0&&!n(r,s)||(a(" "),a(i),a('="'),a(l(r)),a('"'))}),a(o?"/>":">"))},end:function(e){e=t.lowercase(e),r||I[e]!==!0||(a("</"),a(e),a(">")),e==r&&(r=!1)},chars:function(e){r||a(l(e))}}}var u=t.$$minErr("$sanitize"),d=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,h=/^<\s*\/\s*([\w:-]+)[^>]*>/,p=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,f=/^</,g=/^<\s*\//,m=/<!--(.*?)-->/g,$=/<!DOCTYPE([^>]*?)>/i,v=/<!\[CDATA\[(.*?)]]>/g,b=/([^\#-~| |!])/g,S=i("area,br,col,hr,img,wbr"),w=i("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),y=i("rp,rt"),A=t.extend({},y,w),x=t.extend({},w,i("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),C=t.extend({},y,i("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),L=i("script,style"),I=t.extend({},S,x,C,A),T=i("background,cite,href,longdesc,src,usemap"),D=t.extend({},T,i("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width")),N=document.createElement("pre"),_=/^(\s*)([\s\S]*?)(\s*)$/;t.module("ngSanitize",[]).provider("$sanitize",r),t.module("ngSanitize").filter("linky",["$sanitize",function(e){var n=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>]/,r=/^mailto:/;return function(i,o){function s(e){e&&p.push(a(e))}function l(e,n){p.push("<a "),t.isDefined(o)&&(p.push('target="'),p.push(o),p.push('" ')),p.push('href="'),p.push(e),p.push('">'),s(n),p.push("</a>")}if(!i)return i;for(var c,u,d,h=i,p=[];c=h.match(n);)u=c[0],c[2]==c[3]&&(u="mailto:"+u),d=c.index,s(h.substr(0,d)),l(u,c[0].replace(r,"")),h=h.substring(d+c[0].length);return s(h),e(p.join(""))}}])}(window,window.angular),angular.module("images",[]).factory("imageStorage",function(){var e=null,t=null,n={},r=null;return{add:function(t){angular.isObject(t)&&(e=this.sortImage(t))},get:function(){return e},getOptions:function(){return n},setOptions:function(e){angular.isObject(e)&&(n=e)},setFolderLocation:function(e){angular.isString(e)&&(r=e)},getFolderLocation:function(){return r},setIndex:function(e){t=e},getIndex:function(){return t},sortImage:function(e){return angular.isArray(e)?e.sort(function(e,t){return e=parseInt(e.Name.replace(/[^0-9]/g,""),10),t=parseInt(t.Name.replace(/[^0-9]/g,""),10),e>t?1:t>e?-1:0}):void 0}}}),angular.module("ngSilent",[]).factory("$ngSilentLocation",["$location",function(e){return{$$silentChangePath:!1,silent:function(t,n){this.prev=e.path();var r=e.url(t);n&&r.replace(),this.$$silentChangePath=e.path()},box:function(e,t){t[e].__silentModeMarker||!function(){var n=t[e];t[e]=function(){t[e]=n}}()}}}]).run(["$rootScope","$location","$ngSilentLocation",function(e,t,n){var r=function(r){var a=n.$$silentChangePath;if(n.$$silentChangePath=!1,a===t.path())for(var i in e.$$listeners.$locationChangeSuccess)n.box(i,e.$$listeners.$locationChangeSuccess)};r.__silentModeMarker=!0,e.$on("$locationChangeSuccess",r)}]),angular.module("spModule",[]).factory("spService",["$http","$q",function(e,t){var n=angular.element(document.querySelector("#__REQUESTDIGEST")).val();return{getDigestValue:function(t,r){null!=n?r(n):e({url:t+"/_api/contextinfo",async:!0,method:"POST",headers:{accept:"application/json;odata=verbose",contentType:"text/xml"}}).then(function(e){n=e.data.d.GetContextWebInformation.FormDigestValue,r(n)},function(e){alert("Cannot get digestValue.")})},getFileBuffer:function(e){var n=t.defer(),r=new FileReader;return r.onload=function(e){n.resolve(e.target.result)},r.onerror=function(e){n.reject(e.target.error)},r.readAsArrayBuffer(e),n.promise},addListFileAttachment:function(t,n,r,a,i,o,s){getDigestValue=this.getDigestValue,this.getFileBuffer(i).then(function(i){var l=a.replace(/^\.+|([|\/&;$%:#~?^{}*'@"<>()+,])|\.+$/g,"");l=l.substr(-128),getDigestValue(t,function(a){e({url:t+"/_api/web/lists/GetByTitle('"+n+"')/items("+r+")/AttachmentFiles/add(FileName='"+l+"')",method:"POST",data:i,processData:!1,transformRequest:function(e){return e},headers:{Accept:"application/json;odata=verbose","X-RequestDigest":a,"Content-Length":i.byteLength}}).then(function(e){o(e)},function(e){s(e)})})})},deleteListFileAttachment:function(t,n,r,a,i,o){getDigestValue=this.getDigestValue,getDigestValue(t,function(s){e({url:t+"/_api/web/lists/GetByTitle('"+n+"')/items("+r+")/AttachmentFiles/getByFileName('"+a+"')",method:"POST",headers:{Accept:"application/json;odata=verbose","X-Http-Method":"DELETE","X-RequestDigest":s}}).then(function(e){i(e)},function(e){o(e)})})},getListItemType:function(e){return("SP.Data."+e[0].toUpperCase()+e.substring(1)+"ListItem").replace(" ","_x0020_")},getListItem:function(t,n,r,a,i,o){e({url:t+"/_api/web/lists/getbytitle('"+n+"')/items('"+r+"')"+a,method:"GET",headers:{Accept:"application/json; odata=verbose"}}).then(function(e){i(e)},function(e){o(e)})},getListItems:function(t,n,r,a,i){e({url:t+"/_api/web/lists/getbytitle('"+n+"')/items"+r,method:"GET",headers:{Accept:"application/json; odata=verbose"}}).then(function(e){a(e)},function(e){i(e)})},addListItem:function(t,n,r,a,i){var o=angular.extend({__metadata:{type:this.getListItemType(n)}},r);this.getDigestValue(t,function(r){e({url:t+"/_api/web/lists/getbytitle('"+n+"')/items",method:"POST",data:JSON.stringify(o),headers:{"Content-Type":"application/json;odata=verbose",Accept:"application/json;odata=verbose","X-RequestDigest":r}}).then(function(e){a(e)},function(e){i(e)})})},updateListItem:function(t,n,r,a,i,o){var s=angular.extend({__metadata:{type:this.getListItemType(n)}},a),l=this.getListItem;this.getDigestValue(t,function(a){l(t,n,r,"",function(t){e({url:t.data.d.__metadata.uri,method:"POST",data:JSON.stringify(s),headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":a,"X-HTTP-Method":"MERGE","If-Match":t.data.d.__metadata.etag}}).then(function(e){i(e)},function(e){o(e)})},function(e){o(e)})})},deleteListItem:function(t,n,r,a,i){var o=this.getListItem;this.getDigestValue(t,function(s){o(t,n,r,"",function(t){e({url:t.data.d.__metadata.uri,method:"POST",headers:{Accept:"application/json;odata=verbose","X-Http-Method":"DELETE","X-RequestDigest":s,"If-Match":t.data.d.__metadata.etag}}).then(function(e){a(e)},function(e){i(e)})},function(e){i(e)})})}}}]),angular.module("setup",[]).controller("setupCtrl",["$scope","$http","$location","initializer","spService","imageStorage","configurationList",function(e,t,n,r,a,i,o){var s=null;e.folderURL="",e.save=function(){var l={PageURL:r.Url.main,SlideFolder:e.folderURL.replace(/(^[^A-Za-z0-9]+|[^A-Za-z0-9]+$)/g,""),encodeURL:r.encodeURL,options:JSON.stringify({headline:e.options.headline,labelheadline:e.options.labelheadline,slideWidth:"480px"})};t({url:"https://"+r.Url.host+r.Url.base+"/_api/web/getFolderByServerRelativeUrl('"+r.Url.base+l.SlideFolder+"')/Files?$select=Title,Name,TimeCreated,TimeLastModified,ListItemAllFields/Description0, ListItemAllFields/OData__Author&$expand=Author,ListItemAllFields",method:"GET",headers:{Accept:"application/json; odata=verbose"}}).then(function(e){i.add(e.data.d.results),i.setFolderLocation(l.SlideFolder),0!==i.get().length&&a.getListItems("https://"+r.Url.host+r.Url.base,o,"?$select=ID, PageURL, SlideFolder, encodeURL, options&$filter=encodeURL eq '"+r.encodeURL+"'",function(e){s=e.data.d.results,s.length>0?a.updateListItem("https://"+r.Url.host+r.Url.base,o,s[0].ID,l,function(e){i.setIndex(1),i.setOptions(JSON.parse(l.options)),n.path("/slide/1")},function(e){}):a.addListItem("https://"+r.Url.host+r.Url.base,o,l,function(e){i.setIndex(1),i.setOptions(JSON.parse(l.options)),n.path("/slide/1")},function(e){})},function(e){})},function(e){})}}]),angular.module("slide",[]).controller("slideShowCtrl",["$scope","$location","$routeParams","$ngSilentLocation","imageStorage","initializer",function(e,t,n,r,a,i){e.slides=[],e.currentSlideNum="",e.totalSlides="",e.options={},e.Url=i.Url,e.slideLocation=null,null===a.get()?i.run().then(function(){e.slides=a.get(),e.options=a.getOptions(),0===e.slides.length&&t.path("/setup"),e.currentSlideNum=parseInt(n.index,10),e.totalSlides=e.slides.length,e.slideLocation=a.getFolderLocation(),a.setIndex(e.currentSlideNum)}):(e.slides=a.get(),e.options=a.getOptions(),e.slideLocation=a.getFolderLocation(),parseInt(n.index,10)<=e.slides.length?(e.currentSlideNum=parseInt(n.index,10),e.currentSlideNum!==a.getIndex()&&a.setIndex(e.currentSlideNum)):(e.currentSlideNum=a.getIndex(),t.path("/slide/"+e.currentSlideNum)),e.totalSlides=e.slides.length),e.leftArrow=function(){e.currentSlideNum-1<=0?(e.currentSlideNum=e.totalSlides,a.setIndex(e.currentSlideNum),r.silent("/slide/"+e.currentSlideNum)):(e.currentSlideNum-=1,a.setIndex(e.currentSlideNum),r.silent("/slide/"+e.currentSlideNum))},e.rightArrow=function(){e.currentSlideNum+1>e.totalSlides?(e.currentSlideNum=1,a.setIndex(e.currentSlideNum),r.silent("/slide/"+e.currentSlideNum)):(e.currentSlideNum+=1,a.setIndex(e.currentSlideNum),r.silent("/slide/"+e.currentSlideNum))}}]),angular.module("myDirectives",[]).directive("imageMove",["$document",function(e){return{link:function(t){t.$on("$destroy",function(){e.unbind("keypress"),angular.element(document.querySelector("#leftArrow")).unbind("click"),angular.element(document.querySelector("#rightArrow")).unbind("click")}),angular.element(document.querySelector("#leftArrow")).bind("click",function(){t.$apply(t.leftArrow())}),angular.element(document.querySelector("#rightArrow")).bind("click",function(){t.$apply(t.rightArrow())}),e.bind("keypress",function(e){44===e.charCode||44===e.keyCode?t.$apply(t.leftArrow()):(46===e.charCode||46===e.keyCode)&&t.$apply(t.rightArrow())})},restrict:"A"}}]);