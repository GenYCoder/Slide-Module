!function(){"use strict";angular.module("base64",[]).constant("$base64",function(){function e(e,t){var n=a.indexOf(e.charAt(t));if(-1==n)throw"Cannot decode base64";return n}function t(t){t=""+t;var n,r,a,o=t.length;if(0==o)return t;if(o%4!=0)throw"Cannot decode base64";n=0,t.charAt(o-1)==i&&(n=1,t.charAt(o-2)==i&&(n=2),o-=4);var s=[];for(r=0;o>r;r+=4)a=e(t,r)<<18|e(t,r+1)<<12|e(t,r+2)<<6|e(t,r+3),s.push(String.fromCharCode(a>>16,a>>8&255,255&a));switch(n){case 1:a=e(t,r)<<18|e(t,r+1)<<12|e(t,r+2)<<6,s.push(String.fromCharCode(a>>16,a>>8&255));break;case 2:a=e(t,r)<<18|e(t,r+1)<<12,s.push(String.fromCharCode(a>>16))}return s.join("")}function n(e,t){var n=e.charCodeAt(t);if(n>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return n}function r(e){if(1!=arguments.length)throw"SyntaxError: Not enough arguments";var t,r,o=[];e=""+e;var s=e.length-e.length%3;if(0==e.length)return e;for(t=0;s>t;t+=3)r=n(e,t)<<16|n(e,t+1)<<8|n(e,t+2),o.push(a.charAt(r>>18)),o.push(a.charAt(r>>12&63)),o.push(a.charAt(r>>6&63)),o.push(a.charAt(63&r));switch(e.length-s){case 1:r=n(e,t)<<16,o.push(a.charAt(r>>18)+a.charAt(r>>12&63)+i+i);break;case 2:r=n(e,t)<<16|n(e,t+1)<<8,o.push(a.charAt(r>>18)+a.charAt(r>>12&63)+a.charAt(r>>6&63)+i)}return o.join("")}var i="=",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";return{encode:r,decode:t}}())}(),function(e,t,n){"use strict";function r(){function e(e,n){return t.extend(new(t.extend(function(){},{prototype:e})),n)}function n(e,t){var n=t.caseInsensitiveMatch,r={originalPath:e,regexp:e},i=r.keys=[];return e=e.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?|\*])?/g,function(e,t,n,r){var a="?"===r?r:null,o="*"===r?r:null;return i.push({name:n,optional:!!a}),t=t||"",""+(a?"":t)+"(?:"+(a?t:"")+(o&&"(.+?)"||"([^/]+)")+(a||"")+")"+(a||"")}).replace(/([\/$\*])/g,"\\$1"),r.regexp=new RegExp("^"+e+"$",n?"i":""),r}var r={};this.when=function(e,i){if(r[e]=t.extend({reloadOnSearch:!0},i,e&&n(e,i)),e){var a="/"==e[e.length-1]?e.substr(0,e.length-1):e+"/";r[a]=t.extend({redirectTo:e},n(a,i))}return this},this.otherwise=function(e){return this.when(null,e),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$http","$templateCache","$sce",function(n,i,a,o,s,l,c,u){function d(e,t){var n=t.keys,r={};if(!t.regexp)return null;var i=t.regexp.exec(e);if(!i)return null;for(var a=1,o=i.length;o>a;++a){var s=n[a-1],l="string"==typeof i[a]?decodeURIComponent(i[a]):i[a];s&&l&&(r[s.name]=l)}return r}function h(){var e=p(),r=m.current;e&&r&&e.$$route===r.$$route&&t.equals(e.pathParams,r.pathParams)&&!e.reloadOnSearch&&!g?(r.params=e.params,t.copy(r.params,a),n.$broadcast("$routeUpdate",r)):(e||r)&&(g=!1,n.$broadcast("$routeChangeStart",e,r),m.current=e,e&&e.redirectTo&&(t.isString(e.redirectTo)?i.path(f(e.redirectTo,e.params)).search(e.params).replace():i.url(e.redirectTo(e.pathParams,i.path(),i.search())).replace()),o.when(e).then(function(){if(e){var n,r,i=t.extend({},e.resolve);return t.forEach(i,function(e,n){i[n]=t.isString(e)?s.get(e):s.invoke(e)}),t.isDefined(n=e.template)?t.isFunction(n)&&(n=n(e.params)):t.isDefined(r=e.templateUrl)&&(t.isFunction(r)&&(r=r(e.params)),r=u.getTrustedResourceUrl(r),t.isDefined(r)&&(e.loadedTemplateUrl=r,n=l.get(r,{cache:c}).then(function(e){return e.data}))),t.isDefined(n)&&(i.$template=n),o.all(i)}}).then(function(i){e==m.current&&(e&&(e.locals=i,t.copy(e.params,a)),n.$broadcast("$routeChangeSuccess",e,r))},function(t){e==m.current&&n.$broadcast("$routeChangeError",e,r,t)}))}function p(){var n,a;return t.forEach(r,function(r,o){!a&&(n=d(i.path(),r))&&(a=e(r,{params:t.extend({},i.search(),n),pathParams:n}),a.$$route=r)}),a||r[null]&&e(r[null],{params:{},pathParams:{}})}function f(e,n){var r=[];return t.forEach((e||"").split(":"),function(e,t){if(0===t)r.push(e);else{var i=e.match(/(\w+)(.*)/),a=i[1];r.push(n[a]),r.push(i[2]||""),delete n[a]}}),r.join("")}var g=!1,m={routes:r,reload:function(){g=!0,n.$evalAsync(h)}};return n.$on("$locationChangeSuccess",h),m}]}function i(){this.$get=function(){return{}}}function a(e,n,r){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(i,a,o,s,l){function c(){d&&(d.$destroy(),d=null),h&&(r.leave(h),h=null)}function u(){var o=e.current&&e.current.locals,s=o&&o.$template;if(t.isDefined(s)){var u=i.$new(),g=e.current,m=l(u,function(e){r.enter(e,null,h||a,function(){!t.isDefined(p)||p&&!i.$eval(p)||n()}),c()});h=m,d=g.scope=u,d.$emit("$viewContentLoaded"),d.$eval(f)}else c()}var d,h,p=o.autoscroll,f=o.onload||"";i.$on("$routeChangeSuccess",u),u()}}}function o(e,t,n){return{restrict:"ECA",priority:-400,link:function(r,i){var a=n.current,o=a.locals;i.html(o.$template);var s=e(i.contents());if(a.controller){o.$scope=r;var l=t(a.controller,o);a.controllerAs&&(r[a.controllerAs]=l),i.data("$ngControllerController",l),i.children().data("$ngControllerController",l)}s(r)}}}var s=t.module("ngRoute",["ng"]).provider("$route",r);s.provider("$routeParams",i),s.directive("ngView",a),s.directive("ngView",o),a.$inject=["$route","$anchorScroll","$animate"],o.$inject=["$compile","$controller","$route"]}(window,window.angular),function(e,t,n){"use strict";function r(){this.$get=["$$sanitizeUri",function(e){return function(t){var n=[];return o(t,c(n,function(t,n){return!/^unsafe/.test(e(t,n))})),n.join("")}}]}function i(e){var n=[],r=c(n,t.noop);return r.chars(e),n.join("")}function a(e){var t,n={},r=e.split(",");for(t=0;t<r.length;t++)n[r[t]]=!0;return n}function o(e,n){function r(e,r,a,o){if(r=t.lowercase(r),A[r])for(;c.last()&&C[c.last()];)i("",c.last());y[r]&&c.last()==r&&i("",r),o=S[r]||!!o,o||c.push(r);var l={};a.replace(p,function(e,t,n,r,i){var a=n||r||i||"";l[t]=s(a)}),n.start&&n.start(r,l,o)}function i(e,r){var i,a=0;if(r=t.lowercase(r))for(a=c.length-1;a>=0&&c[a]!=r;a--);if(a>=0){for(i=c.length-1;i>=a;i--)n.end&&n.end(c[i]);c.length=a}}var a,o,l,c=[],b=e;for(c.last=function(){return c[c.length-1]};e;){if(o=!0,c.last()&&L[c.last()])e=e.replace(new RegExp("(.*)<\\s*\\/\\s*"+c.last()+"[^>]*>","i"),function(e,t){return t=t.replace(m,"$1").replace(v,"$1"),n.chars&&n.chars(s(t)),""}),i("",c.last());else if(0===e.indexOf("<!--")?(a=e.indexOf("--",4),a>=0&&e.lastIndexOf("-->",a)===a&&(n.comment&&n.comment(e.substring(4,a)),e=e.substring(a+3),o=!1)):$.test(e)?(l=e.match($),l&&(e=e.replace(l[0],""),o=!1)):g.test(e)?(l=e.match(h),l&&(e=e.substring(l[0].length),l[0].replace(h,i),o=!1)):f.test(e)&&(l=e.match(d),l&&(e=e.substring(l[0].length),l[0].replace(d,r),o=!1)),o){a=e.indexOf("<");var w=0>a?e:e.substring(0,a);e=0>a?"":e.substring(a),n.chars&&n.chars(s(w))}if(e==b)throw u("badparse","The sanitizer was unable to parse the following block of html: {0}",e);b=e}i()}function s(e){if(!e)return"";var t=U.exec(e),n=t[1],r=t[3],i=t[2];return i&&(N.innerHTML=i.replace(/</g,"&lt;"),i="textContent"in N?N.textContent:N.innerText),n+i+r}function l(e){return e.replace(/&/g,"&amp;").replace(b,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function c(e,n){var r=!1,i=t.bind(e,e.push);return{start:function(e,a,o){e=t.lowercase(e),!r&&L[e]&&(r=e),r||I[e]!==!0||(i("<"),i(e),t.forEach(a,function(r,a){var o=t.lowercase(a),s="img"===e&&"src"===o||"background"===o;D[o]!==!0||T[o]===!0&&!n(r,s)||(i(" "),i(a),i('="'),i(l(r)),i('"'))}),i(o?"/>":">"))},end:function(e){e=t.lowercase(e),r||I[e]!==!0||(i("</"),i(e),i(">")),e==r&&(r=!1)},chars:function(e){r||i(l(e))}}}var u=t.$$minErr("$sanitize"),d=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,h=/^<\s*\/\s*([\w:-]+)[^>]*>/,p=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,f=/^</,g=/^<\s*\//,m=/<!--(.*?)-->/g,$=/<!DOCTYPE([^>]*?)>/i,v=/<!\[CDATA\[(.*?)]]>/g,b=/([^\#-~| |!])/g,S=a("area,br,col,hr,img,wbr"),w=a("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),x=a("rp,rt"),y=t.extend({},x,w),A=t.extend({},w,a("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),C=t.extend({},x,a("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),L=a("script,style"),I=t.extend({},S,A,C,y),T=a("background,cite,href,longdesc,src,usemap"),D=t.extend({},T,a("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width")),N=document.createElement("pre"),U=/^(\s*)([\s\S]*?)(\s*)$/;t.module("ngSanitize",[]).provider("$sanitize",r),t.module("ngSanitize").filter("linky",["$sanitize",function(e){var n=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>]/,r=/^mailto:/;return function(a,o){function s(e){e&&p.push(i(e))}function l(e,n){p.push("<a "),t.isDefined(o)&&(p.push('target="'),p.push(o),p.push('" ')),p.push('href="'),p.push(e),p.push('">'),s(n),p.push("</a>")}if(!a)return a;for(var c,u,d,h=a,p=[];c=h.match(n);)u=c[0],c[2]==c[3]&&(u="mailto:"+u),d=c.index,s(h.substr(0,d)),l(u,c[0].replace(r,"")),h=h.substring(d+c[0].length);return s(h),e(p.join(""))}}])}(window,window.angular),angular.module("images",[]).factory("imageStorage",function(){var e=null,t=null,n={},r=null;return{add:function(t){angular.isObject(t)&&(e=this.sortImage(t))},get:function(){return e},getOptions:function(){return n},setOptions:function(e){angular.isObject(e)&&(n=e)},setFolderLocation:function(e){angular.isString(e)&&(r=e)},getFolderLocation:function(){return r},setIndex:function(e){t=e},getIndex:function(){return t},sortImage:function(e){return angular.isArray(e)?e.sort(function(e,t){return e=parseInt(e.Name.replace(/[^0-9]/g,""),10),t=parseInt(t.Name.replace(/[^0-9]/g,""),10),e>t?1:t>e?-1:0}):void 0}}}),angular.module("ngSilent",[]).factory("$ngSilentLocation",["$location",function(e){return{$$silentChangePath:!1,silent:function(t,n){this.prev=e.path();var r=e.url(t);n&&r.replace(),this.$$silentChangePath=e.path()},box:function(e,t){t[e].__silentModeMarker||!function(){var n=t[e];t[e]=function(){t[e]=n}}()}}}]).run(["$rootScope","$location","$ngSilentLocation",function(e,t,n){var r=function(r){var i=n.$$silentChangePath;if(n.$$silentChangePath=!1,i===t.path())for(var a in e.$$listeners.$locationChangeSuccess)n.box(a,e.$$listeners.$locationChangeSuccess)};r.__silentModeMarker=!0,e.$on("$locationChangeSuccess",r)}]),angular.module("spModule",[]).factory("spService",["$http","$q",function(e,t){var n=angular.element(document.querySelector("#__REQUESTDIGEST")).val();return{getDigestValue:function(t,r){null!=n?r(n):e({url:t+"/_api/contextinfo",async:!0,method:"POST",headers:{accept:"application/json;odata=verbose",contentType:"text/xml"}}).then(function(e){n=e.data.d.GetContextWebInformation.FormDigestValue,r(n)},function(e){alert("Cannot get digestValue.")})},getFileBuffer:function(e){var n=t.defer(),r=new FileReader;return r.onload=function(e){n.resolve(e.target.result)},r.onerror=function(e){n.reject(e.target.error)},r.readAsArrayBuffer(e),n.promise},addListFileAttachment:function(t,n,r,i,a,o,s){getDigestValue=this.getDigestValue,this.getFileBuffer(a).then(function(a){var l=i.replace(/^\.+|([|\/&;$%:#~?^{}*'@"<>()+,])|\.+$/g,"");l=l.substr(-128),getDigestValue(t,function(i){e({url:t+"/_api/web/lists/GetByTitle('"+n+"')/items("+r+")/AttachmentFiles/add(FileName='"+l+"')",method:"POST",data:a,processData:!1,transformRequest:function(e){return e},headers:{Accept:"application/json;odata=verbose","X-RequestDigest":i,"Content-Length":a.byteLength}}).then(function(e){o(e)},function(e){s(e)})})})},deleteListFileAttachment:function(t,n,r,i,a,o){getDigestValue=this.getDigestValue,getDigestValue(t,function(s){e({url:t+"/_api/web/lists/GetByTitle('"+n+"')/items("+r+")/AttachmentFiles/getByFileName('"+i+"')",method:"POST",headers:{Accept:"application/json;odata=verbose","X-Http-Method":"DELETE","X-RequestDigest":s}}).then(function(e){a(e)},function(e){o(e)})})},getListItemType:function(e){return("SP.Data."+e[0].toUpperCase()+e.substring(1)+"ListItem").replace(" ","_x0020_")},getListItem:function(t,n,r,i,a,o){e({url:t+"/_api/web/lists/getbytitle('"+n+"')/items('"+r+"')"+i,method:"GET",headers:{Accept:"application/json; odata=verbose"}}).then(function(e){a(e)},function(e){o(e)})},getListItems:function(t,n,r,i,a){e({url:t+"/_api/web/lists/getbytitle('"+n+"')/items"+r,method:"GET",headers:{Accept:"application/json; odata=verbose"}}).then(function(e){i(e)},function(e){a(e)})},addListItem:function(t,n,r,i,a){var o=angular.extend({__metadata:{type:this.getListItemType(n)}},r);this.getDigestValue(t,function(r){e({url:t+"/_api/web/lists/getbytitle('"+n+"')/items",method:"POST",data:JSON.stringify(o),headers:{"Content-Type":"application/json;odata=verbose",Accept:"application/json;odata=verbose","X-RequestDigest":r}}).then(function(e){i(e)},function(e){a(e)})})},updateListItem:function(t,n,r,i,a,o){var s=angular.extend({__metadata:{type:this.getListItemType(n)}},i),l=this.getListItem;this.getDigestValue(t,function(i){l(t,n,r,"",function(t){e({url:t.data.d.__metadata.uri,method:"POST",data:JSON.stringify(s),headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":i,"X-HTTP-Method":"MERGE","If-Match":t.data.d.__metadata.etag}}).then(function(e){a(e)},function(e){o(e)})},function(e){o(e)})})},deleteListItem:function(t,n,r,i,a){var o=this.getListItem;this.getDigestValue(t,function(s){o(t,n,r,"",function(t){e({url:t.data.d.__metadata.uri,method:"POST",headers:{Accept:"application/json;odata=verbose","X-Http-Method":"DELETE","X-RequestDigest":s,"If-Match":t.data.d.__metadata.etag}}).then(function(e){i(e)},function(e){a(e)})},function(e){a(e)})})}}}]),angular.module("setup",[]).controller("setupCtrl",["$scope","$http","$location","initializer","spService","imageStorage","configurationList",function(e,t,n,r,i,a,o){var s=null;e.folderURL="",e.options={headline:"",labelheadline:""},e.save=function(){var l={PageURL:r.Url.main,SlideFolder:e.folderURL.replace(/(^[^A-Za-z0-9]+|[^A-Za-z0-9]+$)/g,""),encodeURL:r.encodeURL,options:JSON.stringify({headline:angular.isUndefined(e.options.headline)?"":e.options.headline,labelheadline:angular.isUndefined(e.options.labelheadline)?"":e.options.labelheadline,slideWidth:"480px",photoCreditWidth:"470px"})};t({url:"https://"+r.Url.host+r.Url.base+"/_api/web/getFolderByServerRelativeUrl('"+r.Url.base+l.SlideFolder+"')/Files?$select=Title,Name,TimeCreated,TimeLastModified,ListItemAllFields/Description0, ListItemAllFields/OData__Author&$expand=Author,ListItemAllFields",method:"GET",headers:{Accept:"application/json; odata=verbose"}}).then(function(e){a.add(e.data.d.results),a.setFolderLocation(l.SlideFolder),0!==a.get().length?i.getListItems("https://"+r.Url.host+r.Url.base,o,"?$select=ID, PageURL, SlideFolder, encodeURL, options&$filter=encodeURL eq '"+r.encodeURL+"'",function(e){s=e.data.d.results,s.length>0?i.updateListItem("https://"+r.Url.host+r.Url.base,o,s[0].ID,l,function(e){a.setIndex(1),a.setOptions(JSON.parse(l.options)),n.path("/slide/1")},function(e){}):i.addListItem("https://"+r.Url.host+r.Url.base,o,l,function(e){a.setIndex(1),a.setOptions(JSON.parse(l.options)),n.path("/slide/1")},function(e){})},function(e){}):alert("The folder does not exist or there are no images on the folder")},function(e){})}}]),angular.module("slide",[]).controller("slideShowCtrl",["$scope","$location","$routeParams","$ngSilentLocation","imageStorage","initializer",function(e,t,n,r,i,a){e.slides=[],e.currentSlideNum="",e.totalSlides="",e.options={},e.Url=a.Url,e.slideLocation=null,null===i.get()?a.run().then(function(){e.slides=i.get(),e.options=i.getOptions(),0===e.slides.length&&t.path("/setup"),e.currentSlideNum=parseInt(n.index,10),e.totalSlides=e.slides.length,e.slideLocation=i.getFolderLocation(),i.setIndex(e.currentSlideNum)}):(e.slides=i.get(),e.options=i.getOptions(),e.slideLocation=i.getFolderLocation(),parseInt(n.index,10)<=e.slides.length?(e.currentSlideNum=parseInt(n.index,10),e.currentSlideNum!==i.getIndex()&&i.setIndex(e.currentSlideNum)):(e.currentSlideNum=i.getIndex(),t.path("/slide/"+e.currentSlideNum)),e.totalSlides=e.slides.length),e.leftArrow=function(){e.currentSlideNum-1<=0?(e.currentSlideNum=e.totalSlides,i.setIndex(e.currentSlideNum),r.silent("/slide/"+e.currentSlideNum)):(e.currentSlideNum-=1,i.setIndex(e.currentSlideNum),r.silent("/slide/"+e.currentSlideNum))},e.rightArrow=function(){e.currentSlideNum+1>e.totalSlides?(e.currentSlideNum=1,i.setIndex(e.currentSlideNum),r.silent("/slide/"+e.currentSlideNum)):(e.currentSlideNum+=1,i.setIndex(e.currentSlideNum),r.silent("/slide/"+e.currentSlideNum))}}]),angular.module("myDirectives",[]).directive("imageMove",["$document",function(e){return{link:function(t){t.$on("$destroy",function(){e.unbind("keypress"),angular.element(document.querySelector("#leftArrow")).unbind("click"),angular.element(document.querySelector("#rightArrow")).unbind("click")}),angular.element(document.querySelector("#leftArrow")).bind("click",function(){t.$apply(t.leftArrow())}),angular.element(document.querySelector("#rightArrow")).bind("click",function(){t.$apply(t.rightArrow())}),e.bind("keypress",function(e){44===e.charCode||44===e.keyCode?t.$apply(t.leftArrow()):(46===e.charCode||46===e.keyCode)&&t.$apply(t.rightArrow())})},restrict:"A"}}]);